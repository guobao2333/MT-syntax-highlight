# 贡献指南 | Contributing Guidelines

您好开发者！欢迎向社区贡献你的力量！🎉

感谢您对 MT Syntax Highlight 项目的关注！我们由衷地欢迎所有形式的贡献，无论是新增语法高亮、改进现有语法、优化文档还是报告问题，您的每一份贡献都让这个项目变得更好。

由于维护者的精力有限，无法提供所有您需要的语言，如果您也编写了一份语法高亮希望让更多人使用，您可以贡献至本项目与开源社区一起维护！

## 目录
- [准备工作](准备工作)
- [如何贡献](#如何贡献)
  - [新语法高亮](#新语法高亮)
  - [改进现有语法](#改进现有语法)
  - [文档改进](#文档改进)
  - [错误报告](#错误报告)
- [开发环境设置](#开发环境设置)
- [代码规范](#代码规范)
- [提交规范](#提交规范)
- [预览图规范](#预览图规范)
- [版本管理](#版本管理)
- [常见问题](#常见问题)

## 准备工作
> [!NOTE]
> **开始前的建议**：
> 如果您使用 MT 管理器编写或检查语法高亮，那么**强烈建议您安装[优化版 MT Syntax 语法高亮](mtsx/builtin/MT-Syntax.mtsx)**，因为它为 `.mtsx` 文件提供了更好的正则语法高亮。
> 
> 我们正在持续优化此内置语法，待后续优化到一定程度后（或许是 3.0 版本时？）将会推送更新至官方内置语法中。
> 
> 下一步？查看[此文档](mt-syntax.md)深入学习 mt 语法高亮开发，或者前往[官方网站](https://mt2.cn/guide/file/mt-syntax.html)查看该文档。

如果您第一次贡献或不明白贡献的概念，请查看[《如何为开源做贡献》](https://opensource.guide/how-to-contribute/)

### 文件命名规范
> [!NOTE]
> **重要命名约定**：
> - **内置语法文件**（位于 `mtsx/builtin/` 目录）：使用大小写混用命名，如 `HTML.mtsx`、`Java.mtsx`、`JavaScript.mtsx`
> - **其他语法文件**（位于 `mtsx/` 目录）：使用英文小写、下划线`_`和连字符`-`命名，如 `markdown.mtsx`、`dockerfile.mtsx`、`proguard-rules.mtsx`
>
> 请遵守现有文件的命名风格，保持项目一致性。

> [!IMPORTANT]
> 由于 GitHub 检测文件后缀来判断项目使用的语言，为了避免混乱，所以在贡献新语法时，请在预览使用的文件添加后缀 `.txt`，例如：`preview.js.txt`

## 如何贡献

### 新语法高亮

**要为本项目贡献新语法，建议您遵循以下步骤：**

0. **第一次贡献？**
   - 点击页面右上角的 `Fork` 按钮克隆仓库，或点击 `Sync fork` 按钮同步最新代码

1. **复刻仓库后，修改已有语法或添加新语法**
   
   1. **开发新语法**
      - 在 `mtsx/` 目录下创建新的 `.mtsx` 文件
      - 文件命名格式：`语言名称.mtsx`（英文小写、下划线`_`和连字符`-`）
      - 在相应的 `preview/语言名称/` 目录下创建预览文件和预览图

   2. **添加预览文件**
      - 新语法**必须**添加预览文件，预览图可以选择性添加
      - 创建预览文件：`preview/语言名称/preview.扩展名.txt`
      - 添加亮色和暗色模式预览图：`preview/语言名称/light.webp` 和 `preview/语言名称/dark.webp`
      - **小提示**：如果您还有空闲，请顺手更新一下 `mtsx/README.md` 和 `preview/README.md`，这可以为维护者减轻负担哦！

   3. **预览图制作小技巧**
      - 添加预览图时，请打开`只读模式`并将预览文件保留在编辑器（上方图钉按钮）
      - 然后分别切换亮色和暗色模式截图
      - 将图片以相同分辨率裁剪，并导出为`webp`格式

2. **测试您的语法**
   - 在 MT 管理器中安装并测试您的语法
   - 确保在各种代码情况下都能正确高亮
   - 可以多找几个样例文件测试，确保覆盖常见语法情况

3. **提交更改**
   ```bash
   git add .
   git commit -m "Add 语言名称 syntax highlighting"
   git push origin add-新语言名称
   ```

4. **点击 `Contribute` 按钮创建新的 Pull Request**
   - 请将开发时参考的资料贴出，以便他人进行后续维护工作
   - 详细描述您添加的语法特性
   - 提供参考资料链接（**非常重要！** 否则此语法的更新优先级将降低，最坏情况将无人维护）

5. **等待代码审查**
   - 接下来请等待代码审查
   - 如果审查结束将会合并代码

如果合并完成，恭喜你🎉您完成了对本项目的贡献！我们由衷地感谢为每个开源项目做出贡献的人，无论贡献多少。

### 改进现有语法

如果您发现现有语法有 bug 或者想为其添加新特性，欢迎进行改进！

1. **Fork 仓库并创建分支**
   ```bash
   git checkout -b improve-语言名称
   ```

2. **分析现有语法**
   - 先理解现有语法的工作原理，看看它如何实现高亮
   - **重要**：遵守源文件的缩进样式（禁止空格 tab 混用）

3. **进行改进**
   - 修复 bug 或添加新特性
   - 确保向后兼容性，尽量不要影响现有功能
   - 如果有必要，更新预览文件以展示改进效果

4. **测试改进**
   - 在各种代码示例上测试，确保覆盖常见情况
   - 确保没有引入新问题

5. **提交和创建 Pull Request**
   - 需要以用户友好的方式具体描述更新内容
   - 说明如何测试这些改进
   - 以此决定如何撰写发布版本号（可以参考[版本号规范](#版本号规范)）

### 文档改进

文档是项目的重要组成部分！如果您发现文档中有任何问题，欢迎帮忙改进：

1. **发现文档问题**
   - 错误信息：比如描述不准确、示例代码有误等
   - 过时内容：比如 API 已更新但文档还是旧的
   - 缺失信息：比如某个功能没有文档说明

2. **改进文档**
   - 修正错误：让描述更准确
   - 更新过时信息：保持文档与代码同步
   - 添加缺失内容：补充未文档化的功能说明

3. **提交改进**
   - 使用清晰的提交信息，比如 `docs: 更新某某文档`
   - 在 PR 中简要说明改进内容，让审查者了解你的修改意图

### 错误报告

如果您在使用过程中发现了 bug 或者遇到了问题，欢迎提交错误报告帮助我们改进！

1. **搜索现有 Issues**
   - 在提交新 issue 之前，请先搜索一下是否已经有人报告过相同的问题
   - 这样可以避免重复，也能让你更快找到解决方案

2. **创建新 Issue**
   - 请使用适当的模板（GitHub 提供了 issue 模板）
   - 提供详细信息：问题现象、期望行为、实际行为等
   - 包含复现步骤：如果能提供复现步骤，将大大帮助我们定位问题

## 开发环境设置

### 必需工具
- **MT 管理器**：最好使用最新版，否则建议使用 2.16.0 及以上版本，因为许多新语法特性需要较高版本才能支持。

### 推荐使用
> [!NOTE]
> **开发小贴士**：如果您使用 MT 编写或检查语法高亮，那么**强烈建议您安装[优化版 MT Syntax 语法高亮](mtsx/builtin/MT-Syntax.mtsx)**，因为它为 `.mtsx` 文件提供了更好的正则语法高亮，能让你的开发体验更顺畅！

### 学习资源
想要深入学习 MT 语法高亮开发？这里有一些资源推荐：
- [MT 语法高亮开发文档](https://mt2.cn/guide/file/mt-syntax.html) - 官方文档，最权威的参考
- [离线开发文档](mt-syntax.md) - 官方文档的离线版本（可能稍旧）
- [Java 正则表达式教程](https://docs.oracle.com/javase/tutorial/essential/regex/) - 因为 MT 语法高亮基于 Java 正则表达式，掌握这个有助于写出更棒的语法高亮

## 代码规范

为了保持代码风格的一致性，让后续维护更容易，我们建议遵循以下规范：

### 基本原则
1. **缩进一致性**：遵守源文件的缩进样式，禁止空格 tab 混用
2. **命名规范**：
   - **内置语法文件**（`mtsx/builtin/`目录下）：使用大小写混用，如 `HTML.mtsx`、`Java.mtsx`、`JavaScript.mtsx`
   - **其他语法文件**（`mtsx/`目录下）：使用英文小写、下划线`_`和连字符`-`，如 `bbcode.mtsx`、`brainfuck.mtsx`、`dockerfile.mtsx`、`proguard-rules.mtsx`
3. **注释规范**：在复杂逻辑处添加注释说明
4. **性能考虑**：避免过于复杂的正则表达式，以免影响性能

### 文件头注释规范
为了保持项目一致性，建议在新语法文件的开头添加以下注释信息：

```js
// require MT >= 2.16.0
// Version: 0.1.0
// Repo: https://github.com/guobao2333/MT-syntax-highlight
// Copyright (c) 2026 <署名>
{
    name: ["语言名称", ".后缀1", ".后缀2"]
    // ... 其余语法配置
}
```

**各项说明：**

- **MT版本要求**（可选）：如果你的语法使用了新版本的 MT 特性，可以在这里指定最低版本，如 `// require MT >= 2.16.0`
- **版本号**：遵循 [语义化版本](https://semver.org)，格式为 `x.y.z`
- **仓库链接**：指向本项目的 GitHub 仓库
- **版权信息**：使用统一的版权声明

如果在已有文件基础上修改，请**保留原有的注释信息**，只需更新版本号等相关内容即可。

### 版本号规范
- 实验版本：`0.1.x`
- 稳定版本：`1.0.x` 及以上
- 主版本：不兼容的 API 修改
- 次版本：向下兼容的功能性新增
- 修订号：向下兼容的问题修正

## 提交规范

清晰规范的提交信息能让代码历史更容易阅读和维护，也方便我们了解每次变更的意图。以下是推荐的提交规范：

### 提交信息格式
```
类型(范围): 简短描述

详细描述（可选）

相关问题: #issue编号
```

### 提交类型
- `feat`: 新功能
- `fix`: 修复 bug
- `docs`: 文档更新
- `style`: 代码格式（不影响功能）
- `refactor`: 重构
- `test`: 测试相关
- `chore`: 日常工作的琐碎变动

### 示例
```markdown
feat: add Python language

- Added support for Python 3.10+ features
- Improved string literal highlighting
- Added comment support

Closes: #123
```

## 预览图规范

为了让其他用户能直观看到语法高亮的效果，我们建议为每个语法提供预览图。下面是一些制作规范：

### 截图要求
1. **分辨率一致**：亮色和暗色模式截图使用相同分辨率
2. **只读模式**：打开只读模式并将预览文件保留在编辑器（上方图钉按钮）
3. **模式切换**：分别截取亮色和暗色模式
4. **格式要求**：导出为 `webp` 格式

### 文件命名
- 亮色模式：`light.webp`
- 暗色模式：`dark.webp`
- 存放位置：`preview/语言名称/`

### 制作流程
1. 在 MT 管理器中打开预览文件
2. 开启只读模式并固定文件
3. 切换到亮色模式，截图
4. 切换到暗色模式，截图
5. 裁剪至相同分辨率
6. 转换为 webp 格式
7. 放置到正确目录

## 版本管理

良好的版本管理能让用户清楚知道语法的更新情况和稳定性。以下是版本管理的一些建议：

### 版本检查清单
- [ ] 语法功能完整
- [ ] 预览文件更新
- [ ] 预览图片更新
- [ ] 文档更新
- [ ] 版本号更新
- [ ] CHANGELOG.md 更新

### 发布流程
1. 更新版本号
2. 更新 CHANGELOG.md
3. 创建 Release
4. 更新相关文档

## 常见问题 (Q&A)

这里整理了一些开发者常遇到的问题和解答，如果你有其他问题，也欢迎随时提出！

### Q: 如何调试语法高亮？
A: 使用 MT 管理器的实时预览功能，配合 `.mtsx_preview` 文件可以快速查看。

### Q: 正则表达式性能优化？
A: 避免嵌套量词，使用非贪婪匹配，合理使用字符组。

### Q: 如何处理复杂语法？
A: 将复杂语法分解为多个简单规则，使用组合方式实现。

### Q: 预览图片的尺寸？
A: 合理裁剪图片，保留主要内容即可，建议高度不超过 2000px。

## 获取帮助

在贡献过程中遇到问题？别担心，这里有一些获取帮助的途径：

1. **查看现有 Issues**：在 [Issues](https://github.com/guobao2333/MT-syntax-highlight/issues) 页面搜索一下，也许你的问题已经有人问过并且有解答了。
2. **创建新的 Issue**：如果找不到相关的问题，欢迎创建新的 issue 来寻求帮助，我们会尽快回复。
3. **参考现有语法文件**：很多时候，查看现有的语法文件实现是最直接的学习方式，你可以参考 `mtsx/` 目录下的文件来了解各种语法是如何实现的。

## 许可证

本项目采用 [Apache-2.0](http://www.apache.org/licenses/LICENSE-2.0) 协议发布。如果您没有特别指定，您贡献的代码默认也将遵循此协议。

详细的许可证信息请查看 [LICENSE](./LICENSE) 文件。

---

**再次感谢您的贡献！** 🎉

每一个贡献，无论大小，都让这个项目变得更好。我们由衷地感谢为开源项目做出贡献的每一位开发者，正是有了你们的支持，这个项目才能持续发展和完善。
